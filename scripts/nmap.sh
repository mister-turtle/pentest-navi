#!/usr/bin/env bash

function _nmap
{
    if ! _nmap_prereq; then
        echo -e "${RED}nmap is not installed or in PATH${NC}"
        exit 1
    fi

    dirs_input="${1:-./scope}"
    dirs_output="./nmap/"
    scan="${2}"
    top="${3}"

    [[ -z "${scan}"          ]] && { echo -e "${RED}No scan type selected${NC}"; exit 1; }
    echo -e "${BLUE}Pentest-Navi - nmap ${scan}${NC}"

    [[ ! -e "${dirs_input}"  ]] && { echo -e "${RED}Input file ${dirs_input} doesnt exist${NC}"; exit 1; }
    [[ ! -d "${dirs_output}" ]] && mkdir -p "${dirs_output}"

    case "${scan}" in

    "http")
        _nmap_internal_http
        ;;
    "top")
        _nmap_internal_top "${top}"
        ;;
    "alltcp")
        _nmap_internal_alltcp
        ;;
    *)
        echo -e "${RED}Scan type ${scan} not supported"
        ;;
    esac

}

function _nmap_internal_http
{
    nmap -Pn -n -vv -d -p 80,443,8080,8443,9000 -iL "${dirs_input}" -oA "${dirs_output}nmap-http"
}

function _nmap_internal_top
{
    num="${1}"
    [[ -z "${num}" ]] && { echo -e "${RED}No number given for top-ports${NC}"; exit 1; }
    nmap -Pn -n -vv -d --top-ports="${num}" -iL "${dirs_input}" -oA "${dirs_output}nmap-tcp-top${num}"
}

function _nmap_internal_alltcp
{
    nmap -Pn -n -vv -d -p- -iL "${dirs_input}" -oA "${dirs_output}nmap-tcp-all"
}

function _nmap_prereq
{
    if ! which nmap &> /dev/null; then
        return 1
    fi
    return 0
}